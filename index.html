<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />

<!-- Mobile upgrade: metas -->
<meta name="theme-color" content="#0f5132">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">

<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Formosa Qualidade - Cestas B√°sicas</title>
<style>
  :root{
    --primary: 152 79% 15%;
    --primary-foreground: 0 0% 100%;
    --secondary: 45 75% 89%;
    --secondary-foreground: 30 50% 30%;
    --accent: 45 100% 45%;
    --accent-foreground: 0 0% 100%;
    --background: 0 0% 98%;
    --foreground: 0 0% 5%;
    --muted: 45 20% 92%;
    --muted-foreground: 0 0% 45%;
    --border: 45 30% 85%;
    --gradient-primary: linear-gradient(135deg, hsl(var(--primary)), hsl(152 70% 25%));
    --gradient-warm: linear-gradient(135deg, hsl(var(--secondary)), hsl(45 85% 95%));
  }

  /* Utilit√°rias */
  .bg-gradient-primary{ background: var(--gradient-primary); }
  .bg-gradient-warm{ background: var(--gradient-warm); }
  .text-primary{ color: hsl(var(--primary)); }
  .text-accent{ color: hsl(var(--accent)); }
  .text-muted-foreground{ color: hsl(var(--muted-foreground)); }
  .text-foreground{ color: hsl(var(--foreground)); }
  .text-on-primary{ color: hsl(var(--primary-foreground)); }
  .bg-primary{ background-color: hsl(var(--primary)); }
  .bg-secondary{ background-color: hsl(var(--secondary)); }
  .bg-background{ background-color: hsl(var(--background)); }
  .bg-accent{ background-color: hsl(var(--accent)); }
  .border-border{ border-color: hsl(var(--border)); }

  /* Reset/estrutura */
  *{ box-sizing: border-box; }
  html, body{ margin:0; padding:0; }
  body{ font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; background: hsl(var(--background)); color: hsl(var(--foreground)); }
  img{ display:block; max-width:100%; height:auto; }
  button{ cursor:pointer; border:none; }

  .container{ max-width: 1100px; margin: 0 auto; padding: 0 16px; }

  /* Header sticky */
  header{
    position: sticky; top:0; z-index: 50;
    box-shadow: 0 8px 20px rgba(0,0,0,.15);
  }
  .header-inner{ display:flex; align-items:center; justify-content:space-between; padding: 14px 0; }
  .brand h1{ margin:0; font-size: 20px; letter-spacing: .5px; }
  .brand p{ margin:0; font-size: 11px; letter-spacing: 2px; opacity:.9; }

  .cart-btn{
    position: relative; color: #fff; background: rgba(255,255,255,.12);
    border:1px solid rgba(255,255,255,.25);
    padding: 8px 12px; border-radius: 8px; display:inline-flex; align-items:center; gap:8px;
  }
  .cart-btn:hover{ background: rgba(255,255,255,.2); }
  .badge{
    position:absolute; top:-8px; right:-8px;
    height:22px; width:22px; border-radius:999px;
    display:flex; align-items:center; justify-content:center;
    font-size: 12px; font-weight: 700;
    background: hsl(var(--accent)); color: hsl(var(--primary));
    border:2px solid #fff;
  }

  /* Hero */
  .hero{ padding: 64px 0; text-align:center; }
  .hero h1{ font-size: clamp(28px, 4vw, 52px); margin:0 0 12px; font-weight: 800; }
  .hero p{ font-size: clamp(16px, 2.5vw, 20px); margin: 0 auto 24px; max-width: 720px; color: hsl(var(--muted-foreground)); }
  .hero-actions{ display:flex; flex-direction:column; gap:12px; align-items:center; justify-content:center; }
  @media (min-width: 640px){
    .hero-actions{ flex-direction:row; }
  }
  .btn-primary{
    background: var(--gradient-primary); color: #fff; padding: 12px 22px; border-radius: 10px; font-size: 16px; font-weight: 700;
  }
  .btn-outline{
    background: transparent; color: hsl(var(--primary));
    border: 2px solid hsl(var(--primary)); padding: 10px 20px; border-radius: 10px; font-size: 16px; font-weight: 700;
  }
  .btn-outline:hover{ background: hsl(var(--primary)); color: #fff; }

  .hero-bullets{ display:flex; flex-wrap:wrap; gap:16px; justify-content:center; margin-top:28px; color: hsl(var(--muted-foreground)); font-size:14px;}
  .dot{ width:8px; height:8px; border-radius:999px; background: hsl(var(--accent)); margin-right:8px; }

  /* Se√ß√£o cestas */
  section{ padding: 64px 0; }
  .sec-title{ text-align:center; margin-bottom: 12px; font-size: clamp(24px, 3.2vw, 36px); font-weight: 800; }
  .sec-sub{ text-align:center; margin: 0 auto 32px; max-width: 720px; color: hsl(var(--muted-foreground)); font-size: 18px; }

  .grid{
    display:grid; gap: 20px;
    grid-template-columns: 1fr;
  }
  @media (min-width: 768px){
    .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
  }
  @media (min-width: 1024px){
    .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); }
  }

  .card{
    background: #fff; border-radius: 14px; overflow:hidden;
    box-shadow: 0 10px 24px rgba(0,0,0,.08);
    display:flex; flex-direction:column;
  }
  .card-body{ padding: 18px; display:flex; flex-direction:column; gap:12px; }
  .price{ font-size: 24px; font-weight: 800; color: hsl(var(--accent)); }

  .muted-box{
    background: #f8f8f8; border:1px solid hsl(var(--border)); border-radius: 10px; padding: 12px;
  }
  .items-list{ list-style:none; padding:0; margin:8px 0 0; font-size:14px; }
  .items-list li{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding: 6px 0; border-bottom: 1px dashed rgba(0,0,0,.06); }
  .items-list li:last-child{ border-bottom: none; }

  .btn-secondary{
    background: hsl(var(--secondary)); color: hsl(var(--secondary-foreground));
    padding: 10px 14px; border-radius:10px; font-weight: 700; width:100%;
  }
  .btn-grad{
    background: var(--gradient-primary); color:#fff; padding: 12px 16px; border-radius:10px; font-weight: 800; width:100%;
  }

  /* Overlay + Sidebar carrinho */
  .overlay{
    position: fixed; inset:0; background: rgba(0,0,0,.5); z-index: 60; display:none;
  }
  .overlay.show{ display:block; }

  /* CORRE√á√ÉO DA BARRA BRANCA LATERAL */
  html, body { overflow-x: hidden; }
  .sidebar{
    position: fixed; inset:0 0 0 auto; width: 100%; max-width: 380px;
    background:#fff; height: 100vh; z-index: 70;
    transform: translateX(100%); transition: transform .25s ease;
    display:flex; flex-direction:column;
  }
  .sidebar.show{ transform: translateX(0); }

  .side-head{ display:flex; align-items:center; justify-content:space-between; padding: 16px; border-bottom: 1px solid #eee; }
  .side-body{ padding: 16px; overflow:auto; flex:1; display:flex; flex-direction:column; gap:12px; }
  .cart-item{ display:flex; gap:12px; border:1px solid #eee; border-radius:10px; padding:10px; }
  .thumb{ width:64px; height:64px; border-radius:8px; object-fit:cover; }
  .qty-controls{ display:flex; align-items:center; gap:6px; margin-top: 8px;}
  .qty-btn{ width:24px; height:24px; border-radius:999px; background:#eee; display:flex; align-items:center; justify-content:center; font-weight:700; }
  .del-btn{ background: transparent; color:#d22; font-size: 13px; margin-left: 6px; }
  .side-foot{ border-top:1px solid #eee; padding: 16px; }
  .total-line{ display:flex; align-items:center; justify-content:space-between; margin-bottom: 12px; font-weight: 800; }

  /* Modal */
  .modal-wrap{ position: fixed; inset:0; z-index: 80; display:none; align-items:center; justify-content:center; padding: 20px; }
  .modal-wrap.show{ display:flex; }
  .modal-overlay{ position:absolute; inset:0; background: rgba(0,0,0,.5); }
  .modal{
    position: relative; background:#fff; border-radius:12px; width:100%; max-width: 480px; max-height: 90vh; overflow:auto; padding: 16px;
  }
  .modal-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
  .modal h3{ margin: 0; font-size: 18px; }
  .modal input, .modal select, .modal textarea{
    width:100%; border:1px solid #ddd; border-radius:8px; padding: 10px; font-size: 14px;
  }
  .form-col{ display:flex; flex-direction:column; gap:10px; }
  .modal .total-line{ margin-top:12px; }
  .close-x{ background: transparent; font-size: 18px; color:#666; }

  /* Controles para cesta personalizada */
  .custom-controls{ display:grid; grid-template-columns: 1fr auto auto; gap:8px; align-items:center; }
  .custom-controls input[type="number"]{ width:64px; }
  .muted-note{ font-size:12px; color: hsl(var(--muted-foreground)); margin-top:6px; }
  .pill{ display:inline-block; padding:2px 8px; font-size:12px; border-radius:999px; background: hsl(var(--muted)); color: hsl(var(--secondary-foreground)); }

  /* Acessibilidade (foco) */
  :focus{ outline: 3px solid rgba(0,120,212,.45); outline-offset: 2px; }

  /* ===== MOBILE UPGRADE PACK ===== */
  @media (max-width: 420px){
    .hero { padding: 40px 0; }
    .sec-sub { font-size: 16px; }
    .btn-primary, .btn-outline, .btn-grad, .btn-secondary {
      min-height: 44px;
      font-size: 15px;
    }
  }
  @media (max-width: 360px){
    .card-body { gap: 10px; }
    .items-list li { padding: 5px 0; }
  }
  .card img {
    content-visibility: auto;
    contain-intrinsic-size: 190px 340px;
  }
  .sidebar { will-change: transform; }
  .overlay { will-change: opacity; }
  @media (prefers-reduced-motion: reduce){
    * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
  }
  :focus { outline-width: 2px; }
  .qty-btn, .del-btn { min-width: 32px; min-height: 32px; }
  html, body { -webkit-font-smoothing: antialiased; -webkit-overflow-scrolling: touch; }
  @media (min-width: 600px) and (max-width: 740px){
    .grid { grid-template-columns: repeat(2, minmax(0,1fr)); }
  }
  * { max-width: 100vw; } /* garante que nada estoure a viewport */
</style>
</head>
<body>
  <header class="bg-gradient-primary" aria-label="Topo do site">
    <div class="container header-inner">
      <div class="brand text-on-primary" aria-label="Marca">
        <h1>FORMOSA</h1>
        <p>QUALIDADE</p>
      </div>
      <button id="openCartBtn" class="cart-btn" aria-label="Abrir carrinho" aria-haspopup="dialog">
        üõí
        <span id="cartBadge" class="badge" aria-live="polite" aria-atomic="true" hidden>0</span>
      </button>
    </div>
  </header>

  <main>
    <section class="hero bg-gradient-warm">
      <div class="container">
        <h1 class="text-primary">Cestas B√°sicas de <span class="text-accent">Qualidade</span></h1>
        <p>Proximidade, qualidade e pre√ßo justo. Entrega r√°pida para sua fam√≠lia.</p>
        <div class="hero-actions">
          <button id="seeBaskets" class="btn-primary" aria-controls="categories" aria-label="Ver cestas">Ver Cestas</button>
          <button id="whatsBtnHero" class="btn-outline" aria-label="Falar no WhatsApp">Falar no WhatsApp</button>
        </div>

        <div class="hero-bullets" role="list">
          <div role="listitem"><span class="dot"></span>Entrega r√°pida</div>
          <div role="listitem"><span class="dot"></span>Pre√ßos justos</div>
          <div role="listitem"><span class="dot"></span>Qualidade garantida</div>
        </div>
      </div>
    </section>

    <section id="categories" aria-label="Nossas Cestas">
      <div class="container">
        <h2 class="sec-title text-primary">Nossas Cestas</h2>
        <p class="sec-sub">Escolha a cesta ideal para sua fam√≠lia. Personalize quando quiser e finalize seu pedido pelo WhatsApp.</p>

        <div id="cardsGrid" class="grid" role="list"></div>
      </div>
    </section>
  </main>

  <div id="overlay" class="overlay" aria-hidden="true"></div>
  <aside id="sidebar" class="sidebar" role="dialog" aria-label="Carrinho" aria-modal="true" aria-hidden="true">
    <div class="side-head">
      <h3 style="margin:0;">Carrinho</h3>
      <button id="closeCartBtn" class="close-x" aria-label="Fechar carrinho">‚úï</button>
    </div>
    <div id="cartBody" class="side-body"></div>
    <div class="side-foot">
      <div class="total-line">
        <span>Total:</span>
        <span id="cartTotal" class="text-accent"></span>
      </div>
      <button id="checkoutBtn" class="btn-grad" disabled>Finalizar pelo WhatsApp</button>
    </div>
  </aside>

  <div id="modalWrap" class="modal-wrap" aria-hidden="true">
    <div id="modalOverlay" class="modal-overlay" tabindex="-1"></div>
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="checkoutTitle">
      <div class="modal-head">
        <h3 id="checkoutTitle">Finalizar Pedido</h3>
        <button id="closeModalBtn" class="close-x" aria-label="Fechar">‚úï</button>
      </div>
      <div class="form-col" id="checkoutForm">
        <input type="text" id="fName" placeholder="Nome completo *" aria-required="true"/>
        <input type="text" id="fWhats" placeholder="WhatsApp *" aria-required="true" inputmode="tel"/>
        <input type="text" id="fAddr" placeholder="Endere√ßo *" aria-required="true"/>

        <input type="text" id="fNeigh" placeholder="Bairro"/>
        <input type="text" id="fCity" placeholder="Cidade"/>
        <input type="text" id="fCEP" placeholder="CEP" inputmode="numeric"/>

        <select id="fPay">
          <option value="PIX">PIX</option>
          <option value="Cart√£o">Cart√£o</option>
          <option value="Dinheiro">Dinheiro</option>
        </select>

        <textarea id="fObs" rows="4" placeholder="Observa√ß√µes"></textarea>
      </div>

      <div class="total-line">
        <span>Total:</span>
        <span id="modalTotal" class="text-accent"></span>
      </div>

      <button id="sendOrderBtn" class="btn-grad" style="width:100%; margin-top:10px;">Enviar Pedido via WhatsApp</button>
    </div>
  </div>

  <!-- ====== Imagens leves (SVG geradas dinamicamente) + App ====== -->
  <script>
    /* Util para gerar data URIs de SVG leves */
    const svgURI = (svg) => 'data:image/svg+xml;utf8,' + encodeURIComponent(svg.trim());

    /* Paletas por cesta */
    const palettes = {
      tradicional: { a:'#167a52', b:'#0f5132', fg:'#ffffff', deco:'#ffe08a' },
      premium:     { a:'#5a2a83', b:'#2f0f49', fg:'#ffffff', deco:'#ffd166' },
      limpeza:     { a:'#1e90ff', b:'#1557b0', fg:'#ffffff', deco:'#a7f3d0' },
      personalizada:{a:'#ff7a59', b:'#ef4444', fg:'#ffffff', deco:'#fde68a' }
    };

    const bannerSVG = (title, subtitle, pal, emoji) => `
      <svg xmlns="http://www.w3.org/2000/svg" width="1440" height="720" viewBox="0 0 1440 720">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="${pal.a}"/>
            <stop offset="100%" stop-color="${pal.b}"/>
          </linearGradient>
        </defs>
        <rect width="100%" height="100%" fill="url(#g)"/>
        <circle cx="120" cy="120" r="60" fill="${pal.deco}" opacity="0.25"/>
        <circle cx="1320" cy="640" r="80" fill="${pal.deco}" opacity="0.2"/>
        <text x="50%" y="42%" text-anchor="middle" font-family="system-ui, Arial" font-weight="800" font-size="56" fill="${pal.fg}">${title}</text>
        <text x="50%" y="54%" text-anchor="middle" font-family="system-ui, Arial" font-size="24" fill="rgba(255,255,255,.9)">${subtitle}</text>
        <text x="50%" y="70%" text-anchor="middle" font-size="72">${emoji}</text>
      </svg>
    `;

    const IMGS = {
      tradicional: svgURI(bannerSVG('Cesta B√°sica Tradicional','Itens essenciais para o dia a dia', palettes.tradicional, 'üß∫üçÖüçö')),
      premium: svgURI(bannerSVG('Cesta B√°sica Premium','Sele√ß√£o refor√ßada e marcas melhores', palettes.premium, 'ü•Çüçáüçû')),
      limpeza: svgURI(bannerSVG('Cesta de Limpeza','Higiene e limpeza para o lar', palettes.limpeza, 'üß¥‚ú®üßΩ')),
      personalizada: svgURI(bannerSVG('Cesta Personalizada','Monte do seu jeito', palettes.personalizada, 'üì¶üìùü•ï')),
      placeholder: svgURI(`
        <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="600">
          <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#eaeaea"/><stop offset="100%" stop-color="#d9d9d9"/>
          </linearGradient></defs>
          <rect width="100%" height="100%" fill="url(#g)"/>
          <text x="50%" y="50%" text-anchor="middle" fill="#7a7a7a" font-size="28" font-family="Arial" dy=".3em">Imagem</text>
        </svg>
      `)
    };

    // ---------- Helpers ----------
    const formatBRL = (n) => new Intl.NumberFormat('pt-BR',{style:'currency', currency:'BRL'}).format(n ?? 0);
    const IMG_PLACEHOLDER = IMGS.placeholder;

    // ---------- Dados das cestas ----------
    const baskets = [
      {
        id: 'tradicional',
        name: 'Cesta B√°sica Tradicional',
        price: 149.90,
        description: 'Itens essenciais para o dia a dia, pensada para fam√≠lia de at√© 4 pessoas por 1 semana.',
        image: IMGS.tradicional,
        items: [
          { id: 'arroz', name: 'Arroz', unit: '5kg', pricePerUnit: 25.90 },
          { id: 'feijao', name: 'Feij√£o', unit: '2kg', pricePerUnit: 18.90 },
          { id: 'macarrao', name: 'Macarr√£o espaguete', unit: '500g', pricePerUnit: 4.90 },
          { id: 'oleo', name: '√ìleo de soja', unit: '900ml', pricePerUnit: 8.90 },
          { id: 'acucar', name: 'A√ß√∫car', unit: '2kg', pricePerUnit: 9.90 },
          { id: 'cafe', name: 'Caf√©', unit: '250g', pricePerUnit: 12.90 },
          { id: 'leitepo', name: 'Leite em p√≥', unit: '200g', pricePerUnit: 8.90 },
          { id: 'sal', name: 'Sal', unit: '1kg', pricePerUnit: 2.90 },
          { id: 'biscoito', name: 'Biscoito salgado', unit: '200g', pricePerUnit: 3.50 }
        ]
      },
      {
        id: 'premium',
        name: 'Cesta B√°sica Premium',
        price: 249.90,
        description: 'Mais itens e marcas selecionadas, para mais qualidade e quantidade.',
        image: IMGS.premium,
        items: [
          { id: 'arroz-p', name: 'Arroz Parboilizado', unit: '5kg', pricePerUnit: 29.90 },
          { id: 'feijao-p', name: 'Feij√£o Carioca', unit: '2kg', pricePerUnit: 22.90 },
          { id: 'macarrao-p', name: 'Macarr√£o de S√™mola', unit: '500g', pricePerUnit: 6.50 },
          { id: 'azeite', name: 'Azeite de Oliva Extra Virgem', unit: '500ml', pricePerUnit: 24.90 },
          { id: 'cafe-p', name: 'Caf√© Superior', unit: '500g', pricePerUnit: 24.90 },
          { id: 'leite-p', name: 'Leite Longa Vida', unit: '1L', pricePerUnit: 4.90 },
          { id: 'geleia', name: 'Geleia de frutas', unit: '300g', pricePerUnit: 11.50 },
          { id: 'biscoito-p', name: 'Biscoito integral', unit: '200g', pricePerUnit: 5.90 },
          { id: 'atum', name: 'Atum enlatado', unit: '120g', pricePerUnit: 7.90 },
          { id: 'sabonete', name: 'Sabonete', unit: '4 unid', pricePerUnit: 9.90 }
        ]
      },
      {
        id: 'limpeza',
        name: 'Cesta B√°sica de Limpeza',
        price: 119.90,
        description: 'Higiene e limpeza para o lar ‚Äî itens essenciais e √∫teis no dia a dia.',
        image: IMGS.limpeza,
        items: [
          { id: 'detergente', name: 'Detergente', unit: '500ml', pricePerUnit: 4.90 },
          { id: 'desinfetante', name: 'Desinfetante', unit: '500ml', pricePerUnit: 7.90 },
          { id: 'sabo-po', name: 'Sab√£o em p√≥', unit: '800g', pricePerUnit: 12.90 },
          { id: 'esponja', name: 'Esponja de lavar lou√ßa', unit: '2 unid', pricePerUnit: 6.50 },
          { id: 'pano', name: 'Pano de ch√£o', unit: '1 unid', pricePerUnit: 5.90 },
          { id: 'saco-lixo', name: 'Saco de lixo', unit: '30L', pricePerUnit: 8.50 },
          { id: 'agua-sani', name: '√Ågua sanit√°ria', unit: '1L', pricePerUnit: 5.50 },
          { id: 'alcool', name: '√Ålcool 70%', unit: '500ml', pricePerUnit: 13.90 },
          { id: 'papel-hig', name: 'Papel higi√™nico', unit: '4 rolos', pricePerUnit: 7.90 }
        ]
      },
      {
        id: 'personalizada',
        name: 'Cesta B√°sica Personalizada',
        price: null,
        customizable: true,
        description: 'Monte sua cesta: selecione frutas/verduras, carnes e itens das demais cestas ‚Äî voc√™ escolhe!',
        image: IMGS.personalizada,
        items: [
          /* Frutas & Verduras */
          { id: 'banana', name: 'Banana', unit: '1kg', pricePerUnit: 7.90, quantity: 1, selected: true, tag: 'Frutas/Verduras' },
          { id: 'maca', name: 'Ma√ß√£', unit: '1kg', pricePerUnit: 9.90, quantity: 1, selected: true, tag: 'Frutas/Verduras' },
          { id: 'tomate', name: 'Tomate', unit: '1kg', pricePerUnit: 8.90, quantity: 1, selected: false, tag: 'Frutas/Verduras' },
          { id: 'alface', name: 'Alface', unit: '1 unid', pricePerUnit: 4.50, quantity: 1, selected: false, tag: 'Frutas/Verduras' },
          { id: 'cenoura', name: 'Cenoura', unit: '1kg', pricePerUnit: 6.90, quantity: 1, selected: false, tag: 'Frutas/Verduras' },

          /* Carnes */
          { id: 'frango-coxa', name: 'Frango (coxa e sobrecoxa)', unit: '1kg', pricePerUnit: 15.90, quantity: 1, selected: true, tag: 'Carnes' },
          { id: 'patinho', name: 'Carne bovina (patinho)', unit: '1kg', pricePerUnit: 39.90, quantity: 1, selected: false, tag: 'Carnes' },
          { id: 'lombo-suin', name: 'Carne su√≠na (lombo)', unit: '1kg', pricePerUnit: 29.90, quantity: 1, selected: false, tag: 'Carnes' },
          { id: 'linguica', name: 'Lingui√ßa', unit: '500g', pricePerUnit: 14.90, quantity: 1, selected: false, tag: 'Carnes' },

          /* Alimentos diversos */
          { id: 'arroz-pers', name: 'Arroz', unit: '5kg', pricePerUnit: 25.90, quantity: 1, selected: true, tag: 'Alimentos' },
          { id: 'feijao-pers', name: 'Feij√£o', unit: '2kg', pricePerUnit: 18.90, quantity: 1, selected: true, tag: 'Alimentos' },
          { id: 'macarrao-pers', name: 'Macarr√£o espaguete', unit: '500g', pricePerUnit: 4.90, quantity: 1, selected: false, tag: 'Alimentos' },
          { id: 'oleo-pers', name: '√ìleo', unit: '900ml', pricePerUnit: 8.90, quantity: 1, selected: false, tag: 'Alimentos' },
          { id: 'acucar-pers', name: 'A√ß√∫car', unit: '2kg', pricePerUnit: 9.90, quantity: 1, selected: false, tag: 'Alimentos' },
          { id: 'cafe-pers', name: 'Caf√©', unit: '250g', pricePerUnit: 12.90, quantity: 1, selected: false, tag: 'Alimentos' },
          { id: 'leitepo-pers', name: 'Leite em p√≥', unit: '200g', pricePerUnit: 8.90, quantity: 1, selected: false, tag: 'Alimentos' },
          { id: 'azeite-pers', name: 'Azeite', unit: '500ml', pricePerUnit: 24.90, quantity: 1, selected: false, tag: 'Alimentos' },

          /* Limpeza */
          { id: 'detergente-pers', name: 'Detergente', unit: '500ml', pricePerUnit: 4.90, quantity: 1, selected: false, tag: 'Limpeza' },
          { id: 'desinfetante-pers', name: 'Desinfetante', unit: '500ml', pricePerUnit: 7.90, quantity: 1, selected: false, tag: 'Limpeza' },
          { id: 'sabo-po-pers', name: 'Sab√£o em p√≥', unit: '800g', pricePerUnit: 12.90, quantity: 1, selected: false, tag: 'Limpeza' },
          { id: 'alcool70-pers', name: '√Ålcool 70% spray', unit: '500ml', pricePerUnit: 13.90, quantity: 1, selected: false, tag: 'Limpeza' },
          { id: 'esponja-pers', name: 'Esponja', unit: '2 unid', pricePerUnit: 6.50, quantity: 1, selected: false, tag: 'Limpeza' }
        ]
      }
    ];

    // ---------- Store do carrinho ----------
    const cart = {
      items: [],
      isOpen: false,
      addItem(item){
        const found = this.items.find(i => i.id === item.id);
        if(found){ found.quantity += item.quantity; }
        else { this.items.push({...item}); }
        renderCart(); updateBadge();
      },
      removeItem(id){
        this.items = this.items.filter(i => i.id !== id);
        renderCart(); updateBadge();
      },
      updateQuantity(id, q){
        const it = this.items.find(i => i.id === id);
        if(!it) return;
        it.quantity = q;
        if(it.quantity <= 0) this.removeItem(id);
        renderCart(); updateBadge();
      },
      getTotalItems(){ return this.items.reduce((s,i)=> s + i.quantity, 0); },
      getTotalPrice(){ return this.items.reduce((s,i)=> s + (i.price * i.quantity), 0); },
      clear(){ this.items = []; renderCart(); updateBadge(); }
    };

    // ---------- Render de Cards ----------
    const grid = document.getElementById('cardsGrid');

    function renderCards(){
      grid.innerHTML = '';
      baskets.forEach(b => {
        const card = document.createElement('article');
        card.className = 'card';
        card.setAttribute('role','listitem');

        // Imagem otimizada
        const img = document.createElement('img');
        img.src = b.image || IMG_PLACEHOLDER;
        img.alt = b.name;
        img.style.height = '190px';
        img.style.objectFit = 'cover';
        img.loading = 'lazy';
        img.decoding = 'async';
        img.fetchPriority = 'low';
        card.appendChild(img);

        const body = document.createElement('div');
        body.className = 'card-body';

        const h3 = document.createElement('h3');
        h3.textContent = b.name;
        h3.className = 'text-primary';
        h3.style.margin = '0';
        h3.style.fontWeight = '800';
        body.appendChild(h3);

        const desc = document.createElement('p');
        desc.className = 'text-muted-foreground';
        desc.textContent = b.description;
        desc.style.margin = '0';
        body.appendChild(desc);

        const price = document.createElement('div');
        price.className = 'price';
        if(b.customizable){
          price.dataset.dynamicFor = b.id;
          price.textContent = formatBRL(calcCustomBasketPrice(b));
        }else{
          price.textContent = formatBRL(b.price);
        }
        body.appendChild(price);

        const toggleBtn = document.createElement('button');
        toggleBtn.className = 'btn-secondary';
        toggleBtn.setAttribute('aria-expanded','false');
        toggleBtn.textContent = 'Ver Conte√∫do';
        body.appendChild(toggleBtn);

        const box = document.createElement('div');
        box.className = 'muted-box';
        box.hidden = true;

        const subTitle = document.createElement('div');
        subTitle.style.fontWeight = '700';
        subTitle.style.marginBottom = '6px';
        subTitle.textContent = b.customizable ? 'Selecione os itens:' : 'Itens inclusos:';
        box.appendChild(subTitle);

        const list = document.createElement('ul');
        list.className = 'items-list';

        // Lazy build da lista (monta s√≥ quando abrir)
        let listIsBuilt = false;
        const buildList = ()=>{
          if (listIsBuilt) return;
          listIsBuilt = true;

          if(b.customizable){
            const groups = {};
            b.items.forEach(it => (groups[it.tag] = groups[it.tag] || []).push(it));

            Object.keys(groups).forEach(tag=>{
              const tagLi = document.createElement('li');
              tagLi.style.justifyContent='flex-start';
              tagLi.style.borderBottom='none';
              const tagLabel = document.createElement('span');
              tagLabel.innerHTML = `<span class="pill">${tag}</span>`;
              tagLi.appendChild(tagLabel);
              list.appendChild(tagLi);

              groups[tag].forEach(it=>{
                const li = document.createElement('li');
                li.dataset.id = it.id;
                const left = document.createElement('div');
                left.style.display='flex'; left.style.flexDirection='column';

                const name = document.createElement('div');
                name.textContent = `${it.name} (${it.unit})`;
                const priceu = document.createElement('small');
                priceu.className='text-muted-foreground';
                priceu.textContent = formatBRL(it.pricePerUnit) + ' /un';

                left.appendChild(name);
                left.appendChild(priceu);

                const controls = document.createElement('div');
                controls.className = 'custom-controls';

                const check = document.createElement('input');
                check.type='checkbox';
                check.checked = !!it.selected;
                check.setAttribute('aria-label', `Selecionar ${it.name}`);

                const qty = document.createElement('input');
                qty.type='number'; qty.min='1'; qty.step='1'; qty.value = it.quantity ?? 1;

                const sub = document.createElement('div');
                sub.className='text-muted-foreground';
                const subtotalFn = ()=> formatBRL((check.checked?1:0) * (it.pricePerUnit * (parseInt(qty.value||'1',10))));
                sub.textContent = subtotalFn();

                const recalc = ()=>{
                  it.selected = check.checked;
                  it.quantity = Math.max(1, parseInt(qty.value||'1',10));
                  updateDynamicPrice(b.id);
                  sub.textContent = subtotalFn();
                };

                check.addEventListener('change', recalc, {passive:true});
                qty.addEventListener('input', recalc);

                controls.appendChild(check);
                controls.appendChild(qty);
                controls.appendChild(sub);

                li.appendChild(left);
                li.appendChild(controls);
                list.appendChild(li);
              });
            });

            const note = document.createElement('div');
            note.className='muted-note';
            note.textContent = 'O pre√ßo da cesta √© a soma dos itens selecionados. Voc√™ pode ajustar quantidades.';
            box.appendChild(list);
            box.appendChild(note);

          } else {
            b.items.forEach(it=>{
              const li = document.createElement('li');
              li.innerHTML = `<span>${it.name} (${it.unit})</span><span>${formatBRL(it.pricePerUnit)}</span>`;
              list.appendChild(li);
            });
            box.appendChild(list);
          }
        };

        body.appendChild(box);

        const addBtn = document.createElement('button');
        addBtn.className = 'btn-grad';
        addBtn.textContent = 'Adicionar ao Carrinho';
        body.appendChild(addBtn);

        toggleBtn.addEventListener('click', ()=>{
          const wasHidden = box.hidden;
          box.hidden = !box.hidden;
          const expanded = !box.hidden;
          toggleBtn.setAttribute('aria-expanded', String(expanded));
          toggleBtn.textContent = expanded ? 'Ocultar Conte√∫do' : 'Ver Conte√∫do';
          if (expanded && wasHidden) buildList(); // monta itens on-demand
        });

        addBtn.addEventListener('click', ()=>{
          if(b.customizable){
            const selectedItems = b.items.filter(it => it.selected);
            if(selectedItems.length === 0){
              alert('Selecione ao menos um item para adicionar √† cesta personalizada.');
              return;
            }
            const priceSum = selectedItems.reduce((s,it)=> s + (it.pricePerUnit * (it.quantity ?? 1)), 0);
            cart.addItem({
              id: b.id,
              name: b.name,
              price: priceSum,
              quantity: 1,
              image: b.image,
              basketItems: selectedItems.map(it=>({
                id: it.id, name: it.name, unit: it.unit, quantity: it.quantity ?? 1, pricePerUnit: it.pricePerUnit
              }))
            });
            alert('Cesta personalizada adicionada ao carrinho!');
          } else {
            cart.addItem({
              id: b.id,
              name: b.name,
              price: b.price,
              quantity: 1,
              image: b.image,
              basketItems: b.items
            });
            alert('Cesta adicionada ao carrinho!');
          }
        });

        card.appendChild(body);
        grid.appendChild(card);
      });
    }

    function calcCustomBasketPrice(basket){
      if(!basket.customizable) return basket.price ?? 0;
      return basket.items.filter(i=>i.selected).reduce((s,i)=> s + (i.pricePerUnit * (i.quantity ?? 1)), 0);
    }
    function updateDynamicPrice(basketId){
      const b = baskets.find(x=>x.id===basketId);
      const pEl = document.querySelector(`.price[data-dynamic-for="${basketId}"]`);
      if(b && pEl) pEl.textContent = formatBRL(calcCustomBasketPrice(b));
    }

    // ---------- Carrinho - UI ----------
    const overlay = document.getElementById('overlay');
    const sidebar = document.getElementById('sidebar');
    const cartBody = document.getElementById('cartBody');
    const cartTotal = document.getElementById('cartTotal');
    const cartBadge = document.getElementById('cartBadge');
    const openCartBtn = document.getElementById('openCartBtn');
    const closeCartBtn = document.getElementById('closeCartBtn');
    const checkoutBtn = document.getElementById('checkoutBtn');

    let lastFocus = null;
    function openCart(){
      lastFocus = document.activeElement;
      overlay.classList.add('show'); overlay.removeAttribute('aria-hidden');
      sidebar.classList.add('show'); sidebar.removeAttribute('aria-hidden');
      cart.isOpen = true;
      closeCartBtn.focus();
    }
    function closeCart(){
      overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true');
      sidebar.classList.remove('show'); sidebar.setAttribute('aria-hidden','true');
      cart.isOpen = false;
      if(lastFocus) lastFocus.focus();
    }

    openCartBtn.addEventListener('click', openCart);
    closeCartBtn.addEventListener('click', closeCart);
    overlay.addEventListener('click', ()=>{
      if(cart.isOpen) closeCart();
      if(modalOpen()) closeModal();
    });

    function renderCart(){
      cartBody.innerHTML = '';
      if(cart.items.length === 0){
        cartBody.innerHTML = '<p class="text-muted-foreground" style="text-align:center;margin:16px 0;">Carrinho vazio</p>';
        cartTotal.textContent = formatBRL(0);
        checkoutBtn.disabled = true;
        return;
      }
      checkoutBtn.disabled = false;
      cart.items.forEach(it=>{
        const row = document.createElement('div');
        row.className = 'cart-item';
        row.innerHTML = `
          <img class="thumb" src="${it.image || IMG_PLACEHOLDER}" alt="${it.name}">
          <div style="flex:1">
            <div style="font-weight:700">${it.name}</div>
            <div class="text-muted-foreground">${formatBRL(it.price)}</div>
            <div class="qty-controls">
              <button class="qty-btn" data-act="minus" aria-label="Diminuir quantidade">-</button>
              <span aria-live="polite">${it.quantity}</span>
              <button class="qty-btn" data-act="plus" aria-label="Aumentar quantidade">+</button>
              <button class="del-btn" data-act="del" aria-label="Excluir item">Excluir</button>
            </div>
          </div>
        `;
        row.querySelector('[data-act="minus"]').addEventListener('click', ()=> cart.updateQuantity(it.id, it.quantity-1));
        row.querySelector('[data-act="plus"]').addEventListener('click', ()=> cart.updateQuantity(it.id, it.quantity+1));
        row.querySelector('[data-act="del"]').addEventListener('click', ()=> cart.removeItem(it.id));
        cartBody.appendChild(row);
      });
      cartTotal.textContent = formatBRL(cart.getTotalPrice());
      document.getElementById('modalTotal').textContent = formatBRL(cart.getTotalPrice());
    }

    function updateBadge(){
      const n = cart.getTotalItems();
      if(n>0){
        cartBadge.hidden = false;
        cartBadge.textContent = String(n);
      } else {
        cartBadge.hidden = true;
        cartBadge.textContent = '0';
      }
    }

    // ---------- Modal Checkout ----------
    const modalWrap = document.getElementById('modalWrap');
    const modalOverlay = document.getElementById('modalOverlay');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const sendOrderBtn = document.getElementById('sendOrderBtn');
    const modalTotal = document.getElementById('modalTotal');

    const fName = document.getElementById('fName');
    const fWhats = document.getElementById('fWhats');
    const fAddr = document.getElementById('fAddr');
    const fNeigh = document.getElementById('fNeigh');
    const fCity = document.getElementById('fCity');
    const fCEP = document.getElementById('fCEP');
    const fPay = document.getElementById('fPay');
    const fObs = document.getElementById('fObs');

    const checkoutTitle = document.getElementById('checkoutTitle');

    function modalOpen(){ return modalWrap.classList.contains('show'); }
    function openModal(){
      if(cart.items.length === 0){ alert('Carrinho vazio. Adicione itens antes de finalizar.'); return; }
      lastFocus = document.activeElement;
      modalWrap.classList.add('show'); modalWrap.removeAttribute('aria-hidden');
      modalTotal.textContent = formatBRL(cart.getTotalPrice());
      fName.focus();
    }
    function closeModal(){
      modalWrap.classList.remove('show'); modalWrap.setAttribute('aria-hidden','true');
      if(lastFocus) lastFocus.focus();
    }
    closeModalBtn.addEventListener('click', closeModal);
    modalOverlay.addEventListener('click', closeModal);

    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){
        if(cart.isOpen) closeCart();
        if(modalOpen()) closeModal();
      }
    });

    checkoutBtn.addEventListener('click', openModal);

    sendOrderBtn.addEventListener('click', ()=>{
      if(!fName.value.trim() || !fWhats.value.trim() || !fAddr.value.trim()){
        alert('Por favor, preencha Nome, WhatsApp e Endere√ßo.');
        return;
      }
      const itemsList = cart.items.map(item => {
        let details = `\n*${item.name} (Qtd: ${item.quantity})* - ${formatBRL(item.price * item.quantity)}`;
        if (item.basketItems && item.basketItems.length > 0) {
          details += '\n' + item.basketItems.map(bItem => `  - ${bItem.name} (${bItem.unit}) Qtd: ${bItem.quantity}`).join('\n');
        }
        return details;
      }).join('\n\n');

      const msg =
`üõí *NOVO PEDIDO - FORMOSA QUALIDADE*

üë§ *Cliente:* ${fName.value.trim()}
üì± *WhatsApp:* ${fWhats.value.trim()}
üìç *Endere√ßo:* ${fAddr.value.trim()}${fNeigh.value?`, ${fNeigh.value.trim()}`:''}${fCity.value?`, ${fCity.value.trim()}`:''}
CEP: ${fCEP.value.trim() || 'N√£o informado'}

üì¶ *Itens do Pedido:*
${itemsList}

üí∞ *Total:* ${formatBRL(cart.getTotalPrice())}
üí≥ *Forma de pagamento:* ${fPay.value}

üìù *Observa√ß√µes:* ${fObs.value.trim() || 'Nenhuma'}`;

      const url = `https://wa.me/5589981314000?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');

      cart.clear();
      closeModal();
      closeCart();
      alert('Pedido enviado com sucesso!');
    });

    // ---------- Hero A√ß√µes ----------
    document.getElementById('seeBaskets').addEventListener('click', ()=>{
      document.getElementById('categories').scrollIntoView({behavior:'smooth'});
    });
    document.getElementById('whatsBtnHero').addEventListener('click', ()=>{
      const message = 'Ol√°! Gostaria de saber mais sobre as cestas b√°sicas da Formosa Qualidade.';
      const url = `https://wa.me/5589981314000?text=${encodeURIComponent(message)}`;
      window.open(url, '_blank');
    });

    // ---------- Init ----------
    renderCards();
    renderCart();
    updateBadge();
  </script>
</body>
</html>
